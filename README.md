# USSD System Documentation

## Table of Contents

1. [Introduction](#introduction)
2. [System Architecture](#system-architecture)
3. [Prerequisites](#prerequisites)
4. [Installation](#installation)
5. [Configuration](#configuration)
6. [Database Schema](#database-schema)
7. [Integration with Africa's Talking Gateway](#integration-with-africas-talking-gateway)
8. [Deployment](#deployment)
9. [Usage](#usage)
10. [Security Considerations](#security-considerations)
11. [Troubleshooting](#troubleshooting)
12. [Future Improvements](#future-improvements)
13. [Conclusion](#conclusion)

## 1. Introduction

This documentation provides a comprehensive guide for the USSD (Unstructured Supplementary Service Data) system built using Node.js, Express, and SQLite database. The system is designed to interact with users through USSD sessions, allowing them to perform various tasks.

## 2. System Architecture

The USSD system follows a client-server architecture. The server is implemented using Node.js and Express, while SQLite is used as the database to store user information and session data. The system integrates with Africa's Talking Gateway for USSD communication. The application is hosted on render.com for scalability and reliability.

## 3. Prerequisites

Before installing the USSD system, ensure you have the following prerequisites:

- Node.js installed on your server
- SQLite database installed
- Africa's Talking account for USSD gateway
- Render.com account for hosting

## 4. Installation

Clone the repository from the provided source:

```bash
git clone https://github.com/Konson22/eResult-ussd-base-app.git
cd eResult-ussd-base-app
```

## Install the required dependencies:

```bash
npm install
```

## 5. Configuration

Configure the system by creating a .env file in the project root with the following variables:

```javaScript
PORT=3000
DB_PATH=./data/ussd.db
AFRICAS_TALKING_USERNAME=<your-username>
AFRICAS_TALKING_API_KEY=<your-api-key>
```

## Database Schema

```sql
CREATE TABLE users (
  StudentID INTEGER PRIMARY KEY AUTOINCREMENT,
  Name TEXT NOT NULL UNIQUE,
  Gender TEXT,
  IndexNo TEXT,
  CentreNo TEXT,
  SchoolName TEXT,
  Chemistry TEXT,
  Biology TEXT,
  Physics TEXT,
  Mathematics TEXT,
  English TEXT,
  CRE TEXT,
  AdditionalMaths TEXT
);


CREATE TABLE sessions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  session_id TEXT NOT NULL UNIQUE,
  phone_number TEXT NOT NULL,
  step INTEGER DEFAULT 1,
  data TEXT,
  FOREIGN KEY(phone_number) REFERENCES users(StudentID) ON DELETE CASCADE
);
```

## Integration with Africa's Talking Gateway

```javaScript
// Example code for sending USSD responses using Africa's Talking SDK
const { AfricasTalking } = require('africastalking');

const username = process.env.AFRICAS_TALKING_USERNAME;
const apiKey = process.env.AFRICAS_TALKING_API_KEY;

const africastalking = new AfricasTalking({ username, apiKey });

// Send USSD response
africastalking.USSD.send({
  to: '<user-phone-number>',
  message: '<response-message>',
  sessionId: '<session-id>',
});

```

## Deployment

Deploy the USSD system to render.com using the provided deployment configurations. Ensure that environment variables are set in the Render dashboard.

```bash
npm start
```

## Usage

The USSD system supports the following actions:

- Dail `*384#` to check results

## Security Considerations

- Use HTTPS to encrypt communication between the client and server.
- Implement proper input validation to prevent SQL injection and other security vulnerabilities.
- Protect sensitive information, such as API keys and database credentials.

## Troubleshooting

If you encounter issues, refer to the logs generated by the application for error details. Check the configurations, and ensure that dependencies are correctly installed.

## Future Improvements

Consider the following improvements for future releases:

- Implement user authentication and authorization.
- Enhance error handling for better user experience.
- Add more USSD actions and features.

## Conclusion

This USSD system provides a foundation for building interactive USSD applications using Node.js, Express, SQLite, and Africa's Talking Gateway. Follow this documentation for installation, configuration, and deployment instructions. For further improvements, refer to the "Future Improvements" section.
